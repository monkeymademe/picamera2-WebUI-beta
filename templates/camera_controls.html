{% extends 'base.html' %}
{% block content %}

<div class="container">
    <br><br>
    <h1>Camera Settings</h1>

    <!-- Accordion for organizing sections -->
    <div class="accordion pt-4" id="settingsAccordion">
        {% for section in settings.sections if section.enabled %}
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#section{{ loop.index }}">
                    {{ section.name }}
                </button>
            </h2>
            <div id="section{{ loop.index }}" class="accordion-collapse collapse" data-bs-parent="#settingsAccordion">
                <div class="accordion-body">
                    
                    <!-- Loop through settings within a section -->
                    {% for setting in section.settings if setting.enabled %}
                    
                        <!-- Include setting-specific template dynamically -->
                        {% include "settings/" + setting.type + ".html" %}

                        <!-- Handle Child Settings (conditionally displayed) -->
                        {% if setting.childsettings %}
                        <div id="{{ setting.id }}_dependencies" class="collapse">
                            {% for child in setting.childsettings if child.enabled %}
                            {% set setting = child %}
                            {% include "settings/" + child.type + ".html" %}
    {% endfor %}
                        </div>
                        {% endif %}
                    
                    {% endfor %} <!-- End settings loop -->

                </div>
            </div>
        </div>
        {% endfor %} <!-- End section loop -->
    </div>

</div>

<!-- JavaScript to toggle child settings visibility based on parent switch state -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".form-check-input").forEach(input => {
            input.addEventListener("change", function () {
                let dependencies = document.getElementById(this.id + "_dependencies");
                if (dependencies) {
                    if (this.checked) {
                        dependencies.classList.add("show"); // Ensure it expands
                    } else {
                        dependencies.classList.remove("show"); // Ensure it collapses
                    }
                }
            });
        });
    });
</script>

{% endblock %}